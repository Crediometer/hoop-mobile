name: Hoop Mobile CI/CD Pipeline

on:
  # 1. Run tests and builds on push to any branch
  push:
    branches: [main]
    tags:
      - 'v*'  # Trigger on version tags like v1.0.0, v2.0.0
  
  # 2. Manual deployment with version input
  workflow_dispatch:
    inputs:
      version:
        description: 'üè∑Ô∏è Version to release (format: X.Y.Z)'
        required: true
        type: string
        default: '0.0.1'
      build_number:
        description: 'üî¢ Build number'
        required: false
        type: string
        default: '10'
      environment:
        description: 'üåç Deploy to environment'
        required: true
        type: choice
        options:
          - development
          - staging
          - production
        default: 'staging'
      platforms:
        description: 'üì± Platforms to build'
        required: true
        type: choice
        options:
          - android
          - ios
          - both
        default: 'android'

env:
  FLUTTER_VERSION: "3.35.1"
  ANDROID_COMPILE_SDK: "34"
  ANDROID_BUILD_TOOLS: "34.0.0"
  ANDROID_SDK_ROOT: "/usr/local/lib/android/sdk"
  JAVA_VERSION: "17"

jobs:
  # ========== SETUP & VALIDATION ==========
  setup:
    name: "üîç Setup & Validate"
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.version.outputs.value }}
      build_number: ${{ steps.build-number.outputs.value }}
      environment: ${{ steps.environment.outputs.value }}
      is_release: ${{ steps.release-check.outputs.is_release }}
      is_tag: ${{ steps.release-check.outputs.is_tag }}
    
    steps:
      - name: "üì• Checkout code"
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
    
      # Android SDK Setup with Caching
      - name: "ü§ñ Setup Android SDK"
        uses: android-actions/setup-android@v3
        with:
          java-version: ${{ env.JAVA_VERSION }}
    
      - name: "üì¶ Cache Android SDK"
        uses: actions/cache@v4
        with:
          path: |
            ${{ env.ANDROID_SDK_ROOT }}/licenses
            ${{ env.ANDROID_SDK_ROOT }}/cmdline-tools
            ${{ env.ANDROID_SDK_ROOT }}/platforms
            ${{ env.ANDROID_SDK_ROOT }}/build-tools
            ${{ env.ANDROID_SDK_ROOT }}/platform-tools
            ${{ env.ANDROID_SDK_ROOT }}/ndk
            ~/.android/cache
          key: android-sdk-${{ runner.os }}-${{ env.ANDROID_COMPILE_SDK }}-${{ env.ANDROID_BUILD_TOOLS }}
          restore-keys: |
            android-sdk-${{ runner.os }}-
    
      - name: "üì¶ Accept Android Licenses"
        run: |
          yes | ${{ env.ANDROID_SDK_ROOT }}/cmdline-tools/latest/bin/sdkmanager --licenses || true
          ${{ env.ANDROID_SDK_ROOT }}/cmdline-tools/latest/bin/sdkmanager --update
    
      # Flutter Setup with Caching
      - name: "üì¶ Setup Flutter with caching"
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          cache: true
          cache-key: flutter-${{ env.FLUTTER_VERSION }}-${{ runner.os }}-${{ hashFiles('pubspec.lock') }}
          cache-path: |
            ~/.pub-cache
            /opt/hostedtoolcache/flutter
            ${{ env.ANDROID_SDK_ROOT }}
    
      - name: "üì¶ Cache Flutter artifacts"
        uses: actions/cache@v4
        with:
          path: |
            /opt/hostedtoolcache/flutter
            ~/.pub-cache/bin
          key: flutter-artifacts-${{ runner.os }}-${{ env.FLUTTER_VERSION }}
          restore-keys: |
            flutter-artifacts-${{ runner.os }}-
    
      - name: "üîÑ Cache Pub dependencies"
        uses: actions/cache@v4
        with:
          path: |
            ~/.pub-cache
            /opt/hostedtoolcache/flutter/.pub-cache
            .dart_tool
          key: pub-cache-${{ runner.os }}-${{ hashFiles('pubspec.lock') }}
          restore-keys: |
            pub-cache-${{ runner.os }}-
    
      - name: "üì¶ Get dependencies"
        run: |
          flutter pub get
          echo "‚úÖ Dependencies installed"
      
      - name: "üß™ Run tests"
        run: |
          flutter test || echo "‚ö†Ô∏è Tests may have failed, continuing with build"
      
      - name: "üè∑Ô∏è Check release type"
        id: release-check
        run: |
          if [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
            echo "is_release=true" >> $GITHUB_OUTPUT
            echo "is_tag=false" >> $GITHUB_OUTPUT
          elif [[ "${{ github.ref }}" == refs/tags/v* ]]; then
            echo "is_release=true" >> $GITHUB_OUTPUT
            echo "is_tag=true" >> $GITHUB_OUTPUT
          else
            echo "is_release=false" >> $GITHUB_OUTPUT
            echo "is_tag=false" >> $GITHUB_OUTPUT
          fi
      
      - name: "üìå Determine version"
        id: version
        run: |
          if [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
            # Manual release - use input
            echo "value=${{ github.event.inputs.version }}" >> $GITHUB_OUTPUT
          elif [[ "${{ github.ref }}" == refs/tags/v* ]]; then
            # Tag release - extract from tag
            TAG_VERSION=${GITHUB_REF#refs/tags/v}
            echo "value=$TAG_VERSION" >> $GITHUB_OUTPUT
          else
            # Regular build - use from pubspec.yaml
            PUBSPEC_VERSION=$(grep 'version:' pubspec.yaml | awk '{print $2}' | cut -d'+' -f1)
            echo "value=$PUBSPEC_VERSION" >> $GITHUB_OUTPUT
          fi
          echo "Version: ${{ steps.version.outputs.value }}"
      
      - name: "üî¢ Determine build number"
        id: build-number
        run: |
          if [[ "${{ github.event_name }}" == "workflow_dispatch" && -n "${{ github.event.inputs.build_number }}" ]]; then
            echo "value=${{ github.event.inputs.build_number }}" >> $GITHUB_OUTPUT
          elif [[ "${{ github.ref }}" == refs/tags/v* ]]; then
            # For tags, use timestamp (YYYYMMDDHHMM)
            echo "value=$(date +%Y%m%d%H%M)" >> $GITHUB_OUTPUT
          else
            # Regular build - use run number
            echo "value=${{ github.run_number }}" >> $GITHUB_OUTPUT
          fi
          echo "Build number: ${{ steps.build-number.outputs.value }}"
      
      - name: "üåç Determine environment"
        id: environment
        run: |
          if [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
            echo "value=${{ github.event.inputs.environment }}" >> $GITHUB_OUTPUT
          elif [[ "${{ github.ref }}" == refs/tags/v* ]]; then
            echo "value=production" >> $GITHUB_OUTPUT
          elif [[ "${{ github.ref_name }}" == "main" ]]; then
            echo "value=production" >> $GITHUB_OUTPUT
          elif [[ "${{ github.ref_name }}" == "staging" ]]; then
            echo "value=staging" >> $GITHUB_OUTPUT
          else
            echo "value=development" >> $GITHUB_OUTPUT
          fi
          echo "Environment: ${{ steps.environment.outputs.value }}"
      
      - name: "üìù Update pubspec.yaml with version"
        if: steps.release-check.outputs.is_release == 'true'
        run: |
          FULL_VERSION="${{ steps.version.outputs.value }}+${{ steps.build-number.outputs.value }}"
          sed -i "s/version: .*/version: $FULL_VERSION/" pubspec.yaml
          echo "‚úÖ Updated pubspec.yaml to version: $FULL_VERSION"
          echo "üìÑ Updated pubspec.yaml:"
          grep 'version:' pubspec.yaml

  # ========== ANDROID BUILD ==========
  android:
    name: "ü§ñ Android"
    runs-on: ubuntu-latest
    needs: setup
    if: needs.setup.outputs.is_release == 'true' && (github.event.inputs.platforms == 'android' || github.event.inputs.platforms == 'both')
    environment: ${{ needs.setup.outputs.environment }}
    
    steps:
      - name: "üì• Checkout code"
        uses: actions/checkout@v4
      
      # Android SDK Setup with Caching
      - name: "ü§ñ Setup Android SDK"
        uses: android-actions/setup-android@v3
        with:
          java-version: ${{ env.JAVA_VERSION }}
    
      - name: "üì¶ Restore Android SDK cache"
        uses: actions/cache@v4
        with:
          path: |
            ${{ env.ANDROID_SDK_ROOT }}/licenses
            ${{ env.ANDROID_SDK_ROOT }}/cmdline-tools
            ${{ env.ANDROID_SDK_ROOT }}/platforms
            ${{ env.ANDROID_SDK_ROOT }}/build-tools
            ${{ env.ANDROID_SDK_ROOT }}/platform-tools
            ${{ env.ANDROID_SDK_ROOT }}/ndk
            ~/.android/cache
          key: android-sdk-${{ runner.os }}-${{ env.ANDROID_COMPILE_SDK }}-${{ env.ANDROID_BUILD_TOOLS }}
          restore-keys: |
            android-sdk-${{ runner.os }}-
      
      - name: "üì¶ Setup Flutter with caching"
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          cache: true
          cache-key: flutter-${{ env.FLUTTER_VERSION }}-${{ runner.os }}-${{ hashFiles('pubspec.lock') }}
          cache-path: |
            ~/.pub-cache
            /opt/hostedtoolcache/flutter
      
      - name: "üîÑ Restore Pub dependencies cache"
        uses: actions/cache@v4
        with:
          path: |
            ~/.pub-cache
            /opt/hostedtoolcache/flutter/.pub-cache
            .dart_tool
          key: pub-cache-${{ runner.os }}-${{ hashFiles('pubspec.lock') }}
          restore-keys: |
            pub-cache-${{ runner.os }}-
      
      - name: "üì¶ Get dependencies"
        run: |
          flutter pub get
          echo "‚úÖ Dependencies restored from cache"
      
      - name: "üìù Apply version"
        run: |
          FULL_VERSION="${{ needs.setup.outputs.version }}+${{ needs.setup.outputs.build_number }}"
          sed -i "s/version: .*/version: $FULL_VERSION/" pubspec.yaml
          echo "Building version: $FULL_VERSION"
      
      # Gradle Caching
      - name: "üì¶ Cache Gradle"
        uses: actions/cache@v4
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
            android/.gradle
          key: gradle-${{ runner.os }}-${{ hashFiles('android/**/*.gradle*', 'android/gradle/wrapper/gradle-wrapper.properties') }}
          restore-keys: |
            gradle-${{ runner.os }}-
      
      # Android signing
      - name: "üîê Setup Android signing"
        run: |
          echo "${{ secrets.ANDROID_KEYSTORE_BASE64 }}" | base64 --decode > android/app/upload.jks
          echo "‚úÖ Keystore created"
      
      - name: "üîë Create key.properties"
        run: |
          cat <<EOF > android/key.properties
          storePassword=${{ secrets.ANDROID_KEYSTORE_PASSWORD }}
          keyPassword=${{ secrets.ANDROID_KEY_PASSWORD }}
          keyAlias=${{ secrets.ANDROID_KEY_ALIAS }}
          storeFile=upload.jks
          EOF
          echo "‚úÖ key.properties created"
      
      # Setup environment-specific main.dart
      - name: "üéØ Setup environment configuration"
        run: |
          ENV="${{ needs.setup.outputs.environment }}"
          echo "Setting up environment: $ENV"
          # Add your environment-specific setup here
          # Example: cp lib/main_$ENV.dart lib/main.dart
      
      # Build Android with caching
      - name: "üì¶ Cache Flutter build artifacts"
        uses: actions/cache@v4
        with:
          path: |
            build/
            android/app/build
          key: flutter-build-${{ runner.os }}-${{ github.sha }}-android
          restore-keys: |
            flutter-build-${{ runner.os }}-android
      
      - name: "üèóÔ∏è Build Android App Bundle"
        run: |
          flutter build appbundle --release --no-tree-shake-icons
          echo "‚úÖ AAB built successfully"
          ls -la build/app/outputs/bundle/release/
          echo "üì¶ AAB size: $(stat -f%z build/app/outputs/bundle/release/app-release.aab) bytes"
      
      # Ruby and Fastlane setup with caching
      - name: "üíé Cache Ruby gems"
        uses: actions/cache@v4
        with:
          path: |
            vendor/bundle
            ~/.bundle
            /usr/local/bundle
          key: ruby-gems-${{ runner.os }}-${{ hashFiles('**/Gemfile.lock') }}
          restore-keys: |
            ruby-gems-${{ runner.os }}-
      
      - name: "‚ö° Setup Ruby and Fastlane (Android)"
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.2'
          bundler-cache: true
          cache-version: 1
          working-directory: ./android
      
      - name: "üì¶ Install Fastlane dependencies"
        run: |
          cd android
          bundle check || bundle install --jobs 4 --retry 3
      
      # Deploy to Play Store
      - name: "üöÄ Deploy to Play Store"
        if: needs.setup.outputs.environment != 'development'
        env:
          PLAY_STORE_JSON: ${{ secrets.PLAY_STORE_JSON }}
        run: |
          # Save Google Play JSON key
          echo "$PLAY_STORE_JSON" > android/play.json
          
          cd android
          
          ENV="${{ needs.setup.outputs.environment }}"
          if [[ "$ENV" == "staging" ]]; then
            echo "üì± Deploying to Play Store Beta track..."
            bundle exec fastlane beta
          elif [[ "$ENV" == "production" ]]; then
            echo "üì± Deploying to Play Store Production..."
            bundle exec fastlane release
          else
            echo "üì± Deploying to Play Store Internal track..."
            bundle exec fastlane internal
          fi
      
      - name: "üì§ Upload artifacts"
        uses: actions/upload-artifact@v4
        with:
          name: android-aab-${{ needs.setup.outputs.environment }}
          path: build/app/outputs/bundle/release/*.aab
          retention-days: 30
          if-no-files-found: error

  # ========== iOS BUILD ==========
  ios:
    name: "üçé iOS"
    runs-on: macos-latest
    needs: setup
    if: needs.setup.outputs.is_release == 'true' && (github.event.inputs.platforms == 'ios' || github.event.inputs.platforms == 'both')
    environment: ${{ needs.setup.outputs.environment }}
    
    steps:
      - name: "üì• Checkout code"
        uses: actions/checkout@v4
      
      - name: "üì¶ Setup Flutter with caching"
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          cache: true
          cache-key: flutter-${{ env.FLUTTER_VERSION }}-${{ runner.os }}-${{ hashFiles('pubspec.lock') }}
          cache-path: |
            ~/.pub-cache
            /opt/hostedtoolcache/flutter
      
      - name: "üîÑ Restore Pub dependencies cache"
        uses: actions/cache@v4
        with:
          path: |
            ~/.pub-cache
            /opt/hostedtoolcache/flutter/.pub-cache
            .dart_tool
          key: pub-cache-${{ runner.os }}-${{ hashFiles('pubspec.lock') }}
          restore-keys: |
            pub-cache-${{ runner.os }}-
      
      - name: "üì¶ Get dependencies"
        run: |
          flutter pub get
          echo "‚úÖ Dependencies restored from cache"
      
      - name: "üìù Apply version"
        run: |
          FULL_VERSION="${{ needs.setup.outputs.version }}+${{ needs.setup.outputs.build_number }}"
          sed -i "" "s/version: .*/version: $FULL_VERSION/" pubspec.yaml
          echo "Building version: $FULL_VERSION"
      
      # iOS dependencies caching
      - name: "üçé Cache iOS dependencies"
        uses: actions/cache@v4
        with:
          path: |
            ~/Library/Caches/CocoaPods
            ~/Library/Developer/Xcode/DerivedData
            ios/Pods
            ~/Library/Caches/org.carthage.CarthageKit
          key: ios-deps-${{ runner.os }}-${{ hashFiles('ios/Podfile.lock', 'ios/Cartfile.resolved') }}
          restore-keys: |
            ios-deps-${{ runner.os }}-
      
      - name: "üì¶ Install iOS dependencies"
        run: |
          cd ios
          pod install --repo-update
          cd ..
      
      # iOS certificates and profiles
      - name: "üîê Setup iOS code signing"
        env:
          IOS_CERTIFICATE_BASE64: ${{ secrets.IOS_CERTIFICATE_BASE64 }}
          IOS_CERTIFICATE_PASSWORD: ${{ secrets.IOS_CERTIFICATE_PASSWORD }}
          IOS_PROVISIONING_BASE64: ${{ secrets.IOS_PROVISIONING_BASE64 }}
        run: |
          # Create keychain
          security create-keychain -p "" build.keychain
          security default-keychain -s build.keychain
          security unlock-keychain -p "" build.keychain
          security set-keychain-settings -t 3600 -u build.keychain
          
          # Import certificate
          echo "$IOS_CERTIFICATE_BASE64" | base64 --decode > certificate.p12
          security import certificate.p12 -k build.keychain -P "$IOS_CERTIFICATE_PASSWORD" -T /usr/bin/codesign
          
          # Import provisioning profile
          mkdir -p ~/Library/MobileDevice/Provisioning\ Profiles
          echo "$IOS_PROVISIONING_BASE64" | base64 --decode > ~/Library/MobileDevice/Provisioning\ Profiles/profile.mobileprovision
          
          # Configure keychain
          security set-key-partition-list -S apple-tool:,apple: -s -k "" build.keychain
          
          # List installed certificates
          echo "Installed certificates:"
          security find-identity -v -p codesigning
          
          echo "‚úÖ iOS code signing setup complete"
      
      # Setup environment-specific main.dart
      - name: "üéØ Setup environment configuration"
        run: |
          ENV="${{ needs.setup.outputs.environment }}"
          echo "Setting up environment: $ENV"
          # Add your environment-specific setup here
          # Example: cp lib/main_$ENV.dart lib/main.dart
      
      # Cache Xcode builds
      - name: "üèóÔ∏è Cache Xcode builds"
        uses: actions/cache@v4
        with:
          path: |
            ~/Library/Developer/Xcode/DerivedData
            ios/build
          key: xcode-build-${{ runner.os }}-${{ github.sha }}
          restore-keys: |
            xcode-build-${{ runner.os }}-
      
      # Build iOS
      - name: "üèóÔ∏è Build iOS IPA"
        run: |
          # Build IPA
          flutter build ipa --release --no-tree-shake-icons
          
          echo "‚úÖ IPA built successfully"
          ls -la build/ios/ipa/
          echo "üì¶ IPA size: $(stat -f%z build/ios/ipa/*.ipa) bytes"
      
      # Ruby and Fastlane setup with caching
      - name: "üíé Cache Ruby gems"
        uses: actions/cache@v4
        with:
          path: |
            vendor/bundle
            ~/.bundle
            /usr/local/bundle
          key: ruby-gems-${{ runner.os }}-${{ hashFiles('**/Gemfile.lock') }}
          restore-keys: |
            ruby-gems-${{ runner.os }}-
      
      - name: "‚ö° Setup Ruby and Fastlane (iOS)"
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.2'
          bundler-cache: true
          cache-version: 1
          working-directory: ./ios
      
      - name: "üì¶ Install Fastlane dependencies"
        run: |
          cd ios
          bundle check || bundle install --jobs 4 --retry 3
      
      # Deploy to TestFlight/App Store
      - name: "üöÄ Deploy to TestFlight/App Store"
        if: needs.setup.outputs.environment != 'development'
        env:
          APP_STORE_KEY_ID: ${{ secrets.APP_STORE_KEY_ID }}
          APP_STORE_ISSUER_ID: ${{ secrets.APP_STORE_ISSUER_ID }}
          APP_STORE_PRIVATE_KEY: ${{ secrets.APP_STORE_PRIVATE_KEY }}
        run: |
          cd ios
          
          # Save App Store Connect API key
          cat <<EOF > api_key.json
          {
            "key_id": "$APP_STORE_KEY_ID",
            "issuer_id": "$APP_STORE_ISSUER_ID",
            "key": "$APP_STORE_PRIVATE_KEY"
          }
          EOF
          
          ENV="${{ needs.setup.outputs.environment }}"
          if [[ "$ENV" == "staging" ]]; then
            echo "üì± Deploying to TestFlight (External)..."
            bundle exec fastlane beta
          elif [[ "$ENV" == "production" ]]; then
            echo "üì± Deploying to App Store..."
            bundle exec fastlane release
          else
            echo "üì± Deploying to TestFlight (Internal)..."
            bundle exec fastlane internal
          fi
      
      - name: "üì§ Upload artifacts"
        uses: actions/upload-artifact@v4
        with:
          name: ios-ipa-${{ needs.setup.outputs.environment }}
          path: build/ios/ipa/*.ipa
          retention-days: 30
          if-no-files-found: error
      
      - name: "üßπ Clean up keychain"
        if: always()
        run: |
          security delete-keychain build.keychain || true

  # ========== NOTIFICATION ==========
  notify:
    name: "üì¢ Notification"
    runs-on: ubuntu-latest
    needs: [setup, android, ios]
    if: always()
    
    steps:
      - name: "üìä Build status summary"
        run: |
          echo "=== CI/CD Pipeline Summary ==="
          echo "Workflow: ${{ github.workflow }}"
          echo "Run: ${{ github.run_number }}"
          echo "Trigger: ${{ github.event_name }}"
          echo "Ref: ${{ github.ref }}"
          echo "Version: ${{ needs.setup.outputs.version }}+${{ needs.setup.outputs.build_number }}"
          echo "Environment: ${{ needs.setup.outputs.environment }}"
          echo "Release: ${{ needs.setup.outputs.is_release }}"
          echo ""
          echo "Job Status:"
          echo "- Setup: ${{ needs.setup.result }}"
          echo "- Android: ${{ needs.android.result || 'skipped' }}"
          echo "- iOS: ${{ needs.ios.result || 'skipped' }}"
          echo ""
          echo "Cache Stats:"
          echo "- Android SDK: Cached"
          echo "- Flutter SDK: Cached"
          echo "- Pub dependencies: Cached"
          echo "- Gradle: Cached"
          echo "- Ruby gems: Cached"
          echo "- iOS dependencies: Cached"
          echo "- Xcode builds: Cached"
          echo ""
          echo "Artifacts are available in GitHub Actions"
      
      - name: "üì± Send Slack notification on failure"
        if: failure()
        uses: 8398a7/action-slack@v3
        with:
          status: failure
          author_name: 'Flutter CI/CD Pipeline'
          icon_emoji: 'üö®'
          fields: workflow,job,commit,ref,author,took
          mention: here
          channel: '#ci-cd-alerts'
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
      
      - name: "üì± Send Slack notification on success"
        if: success() && needs.setup.outputs.is_release == 'true'
        uses: 8398a7/action-slack@v3
        with:
          status: success
          author_name: 'Flutter CI/CD Pipeline'
          icon_emoji: '‚úÖ'
          fields: workflow,job,commit,ref,author,took
          mention: here
          channel: '#deployments'
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
      
      - name: "üìß Send email notification"
        if: always() && needs.setup.outputs.is_release == 'true'
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: ${{ secrets.SMTP_SERVER }}
          server_port: ${{ secrets.SMTP_PORT }}
          username: ${{ secrets.SMTP_USERNAME }}
          password: ${{ secrets.SMTP_PASSWORD }}
          subject: "Deployment ${{ job.status }}: ${{ needs.setup.outputs.environment }} v${{ needs.setup.outputs.version }}+${{ needs.setup.outputs.build_number }}"
          to: ${{ secrets.DEPLOYMENT_NOTIFICATION_EMAILS }}
          from: "CI/CD Bot <ci-cd@yourcompany.com>"
          body: |
            Deployment ${{ job.status }}!
            
            Project: Hoop Mobile
            Version: ${{ needs.setup.outputs.version }}+${{ needs.setup.outputs.build_number }}
            Environment: ${{ needs.setup.outputs.environment }}
            Triggered by: ${{ github.actor }}
            Branch/Tag: ${{ github.ref }}
            Run: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}
            
            Build Status:
            - Setup: ${{ needs.setup.result }}
            - Android: ${{ needs.android.result || 'skipped' }}
            - iOS: ${{ needs.ios.result || 'skipped' }}
            
            Cache Status: All dependencies cached for faster builds